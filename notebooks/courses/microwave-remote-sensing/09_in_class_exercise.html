
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Phase Unwrapping &#8212; Project Pythia Cookbook Template</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-pythia-theme.min.css?v=ba7ce088" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=d0efeab3" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/courses/microwave-remote-sensing/09_in_class_exercise';</script>
    <link rel="icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Classification of Sentinel-2 imagery" href="../../templates/classification.html" />
    <link rel="prev" title="Interferograms" href="08_in_class_exercise.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
    <meta name="docbuild:last-update" content="10 January 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>

  
  <div class="pst-scroll-pixel-helper"></div>
    <header class="bd-header navbar navbar-dark navbar-expand-lg bg-dark fixed-top bd-navbar shadow" id="navbar-main">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
     
  

<a class="navbar-brand logo" href="https://projectpythia.org">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/pythia_logo-white-rtext.svg" class="logo__image only-light" alt="Project Pythia Cookbook Template - Home"/>
    <img src="../../../_static/pythia_logo-white-rtext.svg" class="logo__image only-dark pst-js-only" alt="Project Pythia Cookbook Template - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><ul id="navbar-main-elements" class="navbar-nav">
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org">Home</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://foundations.projectpythia.org">Foundations</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://cookbooks.projectpythia.org">Cookbooks</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org/resource-gallery.html">Resources</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org/index.html#join-us">Community</a>
  </li>
  
  
</ul></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/TUW-GEO" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCoZPBqJal5uKpO8ZiwzavCw" title="YouTube" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-youtube-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">YouTube</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
        
        
        
        <div class="bd-sidebar-primary bd-sidebar">
          

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item"><ul id="navbar-main-elements" class="navbar-nav">
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org">Home</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://foundations.projectpythia.org">Foundations</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://cookbooks.projectpythia.org">Cookbooks</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org/resource-gallery.html">Resources</a>
  </li>
  
  <li class="nav-item">
    
    
    
    <a class="nav-link nav-internal" href="https://projectpythia.org/index.html#join-us">Community</a>
  </li>
  
  
</ul></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/TUW-GEO" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCoZPBqJal5uKpO8ZiwzavCw" title="YouTube" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-youtube-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">YouTube</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../README.html">
                    Earth Observation Datascience Cookbook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preamble</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../how-to-cite.html">How to Cite This Cookbook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Courses</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../microwave-remote-sensing.html">Microwave Remote Sensing</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_in_class_exercise.html">Discover and Read SAR Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_in_class_exercise.html">Unit Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_in_class_exercise.html">Backscattering Coefficients</a></li>

<li class="toctree-l2"><a class="reference internal" href="04_in_class_exercise.html">Datacubes</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_in_class_exercise.html">Wavelength and Polarization</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_in_class_exercise.html">Dielectric Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_in_class_exercise.html">Speckle Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="08_in_class_exercise.html">Interferograms</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Phase Unwrapping</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Templates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/classification.html">Classification of Sentinel-2 imagery</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/floodmapping.html">Reverend Bayes updates our Belief in Flood Detection</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


        </div>

        
        <main id="main-content" class="bd-main" role="main">
          

            <div class="bd-content">

              <div class="bd-article-container">

                
                  
                  
<div id="searchbox"></div>
                  <article class="bd-article">
                    
  <section class="tex2jax_ignore mathjax_ignore" id="phase-unwrapping">
<h1>Phase Unwrapping<a class="headerlink" href="#phase-unwrapping" title="Link to this heading"><i class="fas fa-link"></i></a></h1>
<p>The goal of this notebook is to read an interferogram image (i.e., 2-D array of phase values) and unwrap it. Phase unwrapping is a critical process in interferometry, which involves recovering unambiguous phase data from the interferogram.</p>
<p>A SAR interferogram represents the phase difference between two radar acquisitions (i.e., two SLC images). The phase difference is usually wrapped within a range of 0 to 2π, because the phase is inherently cyclical. When the true phase difference exceeds 2π, it gets “wrapped” into this range, creating a discontinuous phase signal. Phase unwrapping refers to the process of reconstructing the continuous phase field from the wrapped phase data.</p>
<p>Unwrapping an interferogram is essential for extracting correct information contained in the phase such as surface topography and earth surface deformations.</p>
<p>There are many approaches that tried to solve the unwrapping problem, tackling challenging scenarios involving noise or large phase discontinuities. Here we present the Network-flow Algorithm for phase unwrapping (C. W. Chen and H. A. Zebker, 2000), which is implemented in the <code class="docutils literal notranslate"><span class="pre">snaphu</span></code> package.</p>
<section id="loading-data">
<h2>Loading Data<a class="headerlink" href="#loading-data" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>The data is stored on the Jupyterhub server, so we need to load it using their respective paths.
In this notebook we will use the resulting wrapped interferogram from notebook “Interferograms”, but we need to process it in the radar geometry in order to unwrap it (while in notebook “Interferograms” we end the whole process by performing the geocoding, just for better visualization purposes).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">patches</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cmcrameri</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cmc</span>  <span class="c1"># noqa: F401</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">snaphu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">intake</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">clear_output</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://huggingface.co/datasets/martinschobben/microwave-remote-sensing/resolve/main/microwave-remote-sensing.yml&quot;</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_catalog</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">complex</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">ds</span><span class="p">[</span><span class="s2">&quot;cmplx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;imag&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set cyclic and linear colormaps</span>
<span class="n">cmap_cyc</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;hls&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># &quot;cmc.romaO&quot;</span>
<span class="n">cmap_lin</span> <span class="o">=</span> <span class="s2">&quot;cmc.roma_r&quot;</span>
<span class="n">cmap_disp</span> <span class="o">=</span> <span class="s2">&quot;cmc.vik&quot;</span>

<span class="c1"># Create a mask for the areas which have no data</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s start by displaying the interferogram that needs to be unwrapped. Recall that due to the Slant Range geometry and the satellite acquisition pass (ascending, in our case), the image appears north/south flipped (with respect to the geocoded image)!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Phase Interferogram Image</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="p">(</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Phase Interferogram Image (Wrapped)&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9e9247a0ac97927f338bbf95575fb1c0ccda77546b933ce50eda90cfc5be54c1.png" src="../../../_images/9e9247a0ac97927f338bbf95575fb1c0ccda77546b933ce50eda90cfc5be54c1.png" />
</div>
</div>
</section>
<section id="id1">
<h2>Phase Unwrapping<a class="headerlink" href="#id1" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>As we will be doing the unwrapping multiple times in this notebook let’s create a function that does the unwrapping for us on <code class="docutils literal notranslate"><span class="pre">xarray</span> <span class="pre">DataArray</span></code> objects.
The actual core function where the unwrapping is happening is <code class="docutils literal notranslate"><span class="pre">snaphu.unwrap_phase</span></code> from the <code class="docutils literal notranslate"><span class="pre">snaphu</span></code> package. This function needs a 2D numpy array as input, where each pixel value is a complex number.
Therefore we have to convert the <code class="docutils literal notranslate"><span class="pre">xarray</span> <span class="pre">DataArray</span></code> to a 2D numpy array with complex values. We do that by combining the phase and intensity bands to a complex array.
The actual unwrapping is essentially an addition of the phase values, such that the values are continuous and not between <span class="math notranslate nohighlight">\(-\pi\)</span> and <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<p><img alt="" src="https://forum.step.esa.int/uploads/default/original/3X/5/d/5d9d18e2a3121a4bb80cb93a8f62aed742e35fc2.png" /></p>
<p><em>Figure 1: Illustration of how the unwrapping of the phase works. (Source: ESA)</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">unwrap_array</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">complex_var</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cmplx&quot;</span><span class="p">,</span>
    <span class="n">ouput_var</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unwrapped&quot;</span><span class="p">,</span>
    <span class="n">mask</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">coherence</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mask_nodata_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">coh_low_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coh_high_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nlooks</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">cost</span><span class="o">=</span><span class="s2">&quot;smooth&quot;</span><span class="p">,</span>
    <span class="n">init</span><span class="o">=</span><span class="s2">&quot;mcf&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unwraps the phase data using the snaphu algorithm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data: xarray DataArray with complex numbers</span>
<span class="sd">    complex_var: Name of the variable with the complex numbers</span>
<span class="sd">    ouput_var: Name of the variable with the unwrapped phase</span>
<span class="sd">    mask: xarray DataArray with mask values</span>
<span class="sd">    coherence: xarray DataArray with coherence values (optional)</span>
<span class="sd">    mask_nodata_value: Value of the no data pixels in the mask</span>
<span class="sd">    coh_low_threshold: Lower threshold for the coherence values</span>
<span class="sd">    coh_high_threshold: Higher threshold for the coherence values</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    xarray DataArray with the unwrapped phase</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the complex data</span>
    <span class="n">data_arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">complex_var</span><span class="p">]</span>

    <span class="c1"># Create a mask for areas with no data</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_arr</span><span class="o">.</span><span class="n">real</span> <span class="o">!=</span> <span class="n">mask_nodata_value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># Apply coherence thresholds if provided</span>
    <span class="k">if</span> <span class="n">coherence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coh_low_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coh_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">coherence</span> <span class="o">&gt;=</span> <span class="n">coh_low_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="n">coh_mask</span>
        <span class="k">if</span> <span class="n">coh_high_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coh_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">coherence</span> <span class="o">&lt;=</span> <span class="n">coh_high_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="n">coh_mask</span>

    <span class="c1"># Apply the mask to the data</span>
    <span class="n">data_arr</span> <span class="o">=</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">coherence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coherence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_arr</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

    <span class="c1"># Unwrap the phase (already in complex form)</span>
    <span class="n">unw</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">snaphu</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span>
        <span class="n">data_arr</span><span class="p">,</span>
        <span class="n">coherence</span><span class="p">,</span>
        <span class="n">nlooks</span><span class="o">=</span><span class="n">nlooks</span><span class="p">,</span>
        <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">,</span>
        <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Clear the output to avoid printing the snaphu output</span>
    <span class="n">clear_output</span><span class="p">()</span>

    <span class="c1"># Build xarray DataArray with the unwrapped phase</span>
    <span class="c1"># unw_da = xr.DataArray(unw, coords=data.coords, dims=data.dims)</span>
    <span class="c1"># data = data.to_dataset()</span>
    <span class="n">data</span><span class="p">[</span><span class="n">ouput_var</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">unw</span><span class="p">)</span>

    <span class="c1"># Mask the unwrapped phase</span>
    <span class="c1"># unw_da = unw_da.where(mask)</span>
    <span class="n">data</span><span class="p">[</span><span class="n">ouput_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ouput_var</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<section id="unwrapping-on-a-subset">
<h3>Unwrapping on a Subset<a class="headerlink" href="#unwrapping-on-a-subset" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p>As the original image is too large to unwrap in a reasonable time, we will unwrap a subset of the image. In this case, we will unwrap an area of 500x500 pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a subset of the data</span>
<span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span>
<span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="mi">2800</span><span class="p">,</span> <span class="mi">1700</span>


<span class="k">def</span><span class="w"> </span><span class="nf">subsetting</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">dx</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dy</span><span class="p">))</span>


<span class="c1"># Subsetting the data arrays</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">subsetting</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

<span class="c1"># Unwrap the subset</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">unwrap_array</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="n">complex_var</span><span class="o">=</span><span class="s2">&quot;cmplx&quot;</span><span class="p">,</span> <span class="n">ouput_var</span><span class="o">=</span><span class="s2">&quot;unwrapped&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s compare the wrapped and unwrapped phase images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Wrapped Phase</span>

<span class="p">(</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Wrapped Phase of the Subset&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Unwrapped Phase</span>
<span class="p">(</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">80</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Unwrapped Phase of the Subset&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Subset inside the complete image</span>
<span class="p">(</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Complete Wrapped Phase Image&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">x_start</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">x0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">y_start</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">y0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">x_end</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dx</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">y_end</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">y0</span> <span class="o">+</span> <span class="n">dy</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

<span class="n">rect</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
    <span class="p">(</span><span class="n">x_start</span><span class="p">,</span> <span class="n">y_start</span><span class="p">),</span>
    <span class="n">x_end</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">,</span>
    <span class="n">y_end</span> <span class="o">-</span> <span class="n">y_start</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Subset&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add the rectangle to the plot</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/35e9383f9cd60d59da68d2c4ee242c7ed8cd6da13d976bc90b72664b507914e0.png" src="../../../_images/35e9383f9cd60d59da68d2c4ee242c7ed8cd6da13d976bc90b72664b507914e0.png" />
</div>
</div>
</section>
<section id="unwrapping-with-coherence-mask">
<h3>Unwrapping with coherence mask<a class="headerlink" href="#unwrapping-with-coherence-mask" title="Link to this heading"><i class="fas fa-link"></i></a></h3>
<p>Additionally, can we try to calculate the unwrapped image, where we are excluding pixels, where the coherence values are lower than a certain threshold. This is done by masking the coherence image with the threshold value and then unwrapping the phase image with the masked coherence image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold1</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">unwrap_array</span><span class="p">(</span>
    <span class="n">subset</span><span class="p">,</span>
    <span class="n">coherence</span><span class="o">=</span><span class="n">subset</span><span class="o">.</span><span class="n">coh</span><span class="p">,</span>
    <span class="n">coh_low_threshold</span><span class="o">=</span><span class="n">threshold1</span><span class="p">,</span>
    <span class="n">complex_var</span><span class="o">=</span><span class="s2">&quot;cmplx&quot;</span><span class="p">,</span>
    <span class="n">ouput_var</span><span class="o">=</span><span class="s2">&quot;unwrapped_coh&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s compare the unwrapped image with and without the coherence mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">unwrapped_coh</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">80</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Unwrapped Phase with Coherence Threshold </span><span class="si">{</span><span class="n">threshold1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">80</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Unwrapped Phase without Coherence Threshold&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/492cf19410596e611c272a383096b4186f6e5ba9f396af8f0fc320f992d83b2a.png" src="../../../_images/492cf19410596e611c272a383096b4186f6e5ba9f396af8f0fc320f992d83b2a.png" />
</div>
</div>
<p>Let’s see if another threshold value for the coherence mask gives better results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold2</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">unwrap_array</span><span class="p">(</span>
    <span class="n">subset</span><span class="p">,</span>
    <span class="n">coherence</span><span class="o">=</span><span class="n">subset</span><span class="o">.</span><span class="n">coh</span><span class="p">,</span>
    <span class="n">coh_low_threshold</span><span class="o">=</span><span class="n">threshold2</span><span class="p">,</span>
    <span class="n">complex_var</span><span class="o">=</span><span class="s2">&quot;cmplx&quot;</span><span class="p">,</span>
    <span class="n">ouput_var</span><span class="o">=</span><span class="s2">&quot;unwrapped_coh2&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">unwrapped_coh2</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">80</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Coherence Threshold 0.5&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">unwrapped_coh</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">80</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Coherence Threshold 0.3&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/f7fa6bf42bb76a7a4026f3358e063c0dd5cf7ea408fb05b0d61cd46705bbdbe2.png" src="../../../_images/f7fa6bf42bb76a7a4026f3358e063c0dd5cf7ea408fb05b0d61cd46705bbdbe2.png" />
</div>
</div>
<p>A higher coherence threshold means that only pixels with a coherence value greater than 0.5 will be used for phase unwrapping. This would result in an unwrapping process that is likely more stable, with reduced noise (invalid phase information in the proximity of the earthquake faults is discarded). However, an excessive coherence threshold might have significant gaps or missing information, especially in areas where motion or surface changes have occurred.
The choice of a coherence threshold depends on the balance you want to strike between the accuracy and coverage of the output unwrapped image.</p>
<p>Keep in mind that in case of large displacements, such as the Ridgecrest earthquake, phase unwrapping can be problematic and lead to poor results: when the displacement is large, the phase difference becomes wrapped multiple times, leading to phase aliasing. In this case, the phase values become ambiguous, we cannot distinguish between multiple phase wraps, thus leading to incorrect results.</p>
</section>
</section>
<section id="applying-an-equation-for-the-displacement-map">
<h2>Applying an Equation for the Displacement Map<a class="headerlink" href="#applying-an-equation-for-the-displacement-map" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>From the unwrapped phase image (we will use the phase masked with a coherence threshold of 0.3) we can calculate the displacement map using the following equation:</p>
<p><span class="math notranslate nohighlight">\(
d = - \frac{\lambda}{4 \cdot \pi} \cdot \Delta \phi_d
\)</span></p>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\lambda = 0.056\)</span> for Sentinel-1</p></li>
<li><p><span class="math notranslate nohighlight">\(\Delta \phi_d\)</span> is the unwrapped image</p></li>
</ul>
<p>This operation can be very useful for monitoring ground deformation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">displacement</span><span class="p">(</span><span class="n">unw</span><span class="p">,</span> <span class="n">lambda_val</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.056</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the displacement from the unwrapped phase</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    unw: xarray DataArray with the unwrapped phase</span>
<span class="sd">    unw: xr.DataArray</span>
<span class="sd">    lambda_val: Wavelength of the radar signal</span>
<span class="sd">    lambda_val: float</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xarray DataArray with the displacement</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">unw</span> <span class="o">*</span> <span class="o">-</span><span class="n">lambda_val</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">disp</span>


<span class="c1"># Calculate the displacement</span>
<span class="n">disp_subset</span> <span class="o">=</span> <span class="n">displacement</span><span class="p">(</span><span class="n">subset</span><span class="o">.</span><span class="n">unwrapped_coh</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the displacement map</span>
<span class="p">(</span>
    <span class="n">disp_subset</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_disp</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Meters [m]&quot;</span><span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Displacement Map of the Subset&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/5b45f3fa863f595afe4e0921c94230fadf8db79e19594e5d0efbf3a7576a8967.png" src="../../../_images/5b45f3fa863f595afe4e0921c94230fadf8db79e19594e5d0efbf3a7576a8967.png" />
</div>
</div>
</section>
<section id="coarsen-approach">
<h2>Coarsen Approach<a class="headerlink" href="#coarsen-approach" title="Link to this heading"><i class="fas fa-link"></i></a></h2>
<p>As the whole data is too large and the processing time already exceeds 20 minutes when using an image with 4000x4000 pixels, we can coarsen the image so that we can unwrap and compute the displacement for the whole scene.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">lowres</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s2">&quot;trim&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lowres</span> <span class="o">=</span> <span class="n">unwrap_array</span><span class="p">(</span>
    <span class="n">lowres</span><span class="p">,</span>
    <span class="n">ntiles</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="n">tile_overlap</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">coherence</span><span class="o">=</span><span class="n">lowres</span><span class="o">.</span><span class="n">coh</span><span class="p">,</span>
    <span class="n">coh_low_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">complex_var</span><span class="o">=</span><span class="s2">&quot;cmplx&quot;</span><span class="p">,</span>
    <span class="n">ouput_var</span><span class="o">=</span><span class="s2">&quot;unwrapped&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now plot the unwrapped image of the low resolution image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the unwrapped phase</span>
<span class="p">(</span>
    <span class="n">lowres</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Unwrapped Phase entire scene (coarsened)&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/a6786807c0203036a26daa627ce9d67f9f263bab8883b78cb01238b01c8b9d03.png" src="../../../_images/a6786807c0203036a26daa627ce9d67f9f263bab8883b78cb01238b01c8b9d03.png" />
</div>
</div>
<p>We can also now calculate the displacement map and compare them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lowres_disp</span> <span class="o">=</span> <span class="n">displacement</span><span class="p">(</span><span class="n">lowres</span><span class="o">.</span><span class="n">unwrapped</span><span class="p">)</span>

<span class="c1"># Plot the displacement map</span>
<span class="p">(</span>
    <span class="n">lowres_disp</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_disp</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Meters [m]&quot;</span><span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Displacement Map entire scene (coarse resolution)&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/09c2e8fbb335cfd674cad53a8106a478204ce3fdb7cdf06e0da5c11d495fe68f.png" src="../../../_images/09c2e8fbb335cfd674cad53a8106a478204ce3fdb7cdf06e0da5c11d495fe68f.png" />
</div>
</div>
<p>Plot a summary of the previous plots:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot summary of previous plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="p">(</span>
    <span class="n">subset</span><span class="o">.</span><span class="n">unwrapped_coh</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">80</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Unwrapped Phase of the subset with Coherence Threshold 0.3&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span>
    <span class="n">disp_subset</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_disp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Meters [m]&quot;</span><span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Displacement Map of the Subset&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span>
    <span class="n">lowres</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_cyc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Unwrapped Phase of the entire scene with Coherence Threshold 0.3 (coarsened)&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span>
    <span class="n">lowres_disp</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_disp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Meters [m]&quot;</span><span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Displacement Map entire scene (coarse resolution)&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9451fab753c765380391b45e509b67350a8b98c1a938a1fe630cf7a1a681011a.png" src="../../../_images/9451fab753c765380391b45e509b67350a8b98c1a938a1fe630cf7a1a681011a.png" />
</div>
</div>
<p>In the following animation, we can capture the 3D displacement caused by the Ridgecrest quake by observing the after and before elevation model.</p>
<p><img alt="" src="../../../_images/ridgecrest.gif" />
<em>Credits: NASA</em></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "microwave-remote-sensing"
        },
        kernelOptions: {
            name: "microwave-remote-sensing",
            path: "./notebooks/courses/microwave-remote-sensing"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'microwave-remote-sensing'</script>

                  </article>

                
                

                
                
                  <footer class="prev-next-footer">
                    
<div class="prev-next-area">
    <a class="left-prev"
       href="08_in_class_exercise.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Interferograms</p>
      </div>
    </a>
    <a class="right-next"
       href="../../templates/classification.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Classification of Sentinel-2 imagery</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                  </footer>
                
              </div>

              
              
                
                  <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data">Loading Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Phase Unwrapping</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unwrapping-on-a-subset">Unwrapping on a Subset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unwrapping-with-coherence-mask">Unwrapping with coherence mask</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-an-equation-for-the-displacement-map">Applying an Equation for the Displacement Map</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coarsen-approach">Coarsen Approach</a></li>
</ul>
  </nav></div>

</div></div>
                
              


                
                <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://binder.projectpythia.org/v2/gh/TUW-GEO/eo-datascience-cookbook/main?urlpath=lab/tree/notebooks/courses/microwave-remote-sensing/09_in_class_exercise.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/TUW-GEO/eo-datascience-cookbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/TUW-GEO/eo-datascience-cookbook/edit/main/notebooks/courses/microwave-remote-sensing/09_in_class_exercise.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/TUW-GEO/eo-datascience-cookbook/issues/new?title=Issue%20on%20page%20%2Fnotebooks/courses/microwave-remote-sensing/09_in_class_exercise.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/courses/microwave-remote-sensing/09_in_class_exercise.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
            </div>

            <footer class="bd-footer-content">
              
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the <a href="https://projectpythia.org/">Project Pythia</a> Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on 10 January 2025.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
            </footer>

        </main>
    </div>
  </div>
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
     
  
  
  
  
    <div class="footer-items__start">
      <div class="container-fluid m-0 p-0">
      
        <div class="footer-item">
  <div class="container-fluid footer-logos">
    <div class="container-xl">
      <div class="row d-flex flex-wrap align-items-center">
        <div class="d-flex col-lg-3 col-md-4 col-sm-6 p-2 mx-auto">
          <img alt="NCAR" src="../../../_images/NSF-NCAR_Lockup-UCAR-Dark_102523.svg" style="width: 100%">
        </div>
        <div class="d-flex col-lg-3 col-md-4 col-sm-6 p-2 mx-auto">
          <img alt="Unidata" src="../../../_images/Unidata_logo_horizontal_1200x300.svg" style="width: 100%">
        </div>
        <div class="d-flex col-lg-3 col-md-4 col-sm-6 p-2 mx-auto">
          <img alt="UAlbany" src="../../../_images/UAlbany-A2-logo-purple-gold.svg" style="width: 100%">
        </div>
      </div>
    </div>
  </div></div>
      
        <div class="footer-item">  <div class="container-fluid footer-info">
    <div class="container-xl">
      <div class="d-flex justify-content-center">
        <p class="py-1 m-0">
            &copy;&nbsp;2024.
        
          By the <a href="https://projectpythia.org/">Project Pythia</a> Community.
        
          Last updated on 10 January 2025.
        </p>
      </div>
    </div>
  </div></div>
      
        <div class="footer-item"><div class="container-fluid footer-extra">
  <div class="container">
    <center>
      Theme by <a href="https://projectpythia.org">Project Pythia</a>. All code
      in Pythia Cookbooks is licensed under
      <a href="https://opensource.org/license/apache-2-0">Apache 2.0</a>. All
      other non-code content is licensed under
      <a href="https://creativecommons.org/licenses/by/4.0/">
        Creative Commons BY 4.0 (CC BY 4.0)</a
      >.
    </center>
    <br /><br />
    <div class="row">
      <p class="m-0">
        <img
          src="../../../_static/footer-logo-nsf.png"
          style="float: left; width: 60px; height: 60px; margin-right: 1rem"
        />
        This material is based upon work supported by the National Science
        Foundation under Grant Nos. 2026863 and 2026899. Any opinions, findings,
        and conclusions or recommendations expressed in this material are those
        of the author(s) and do not necessarily reflect the views of the
        National Science Foundation.
      </p>
    </div>
  </div>
</div></div>
      
      </div>
    </div>
  

  </footer>
  </body>
</html>